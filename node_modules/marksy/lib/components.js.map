{"version":3,"sources":["../src/components.js"],"names":["marksy","options","components","tracker","tree","elements","nextElementId","toc","renderer","html","code","presets","Object","keys","map","key","push","createElement","Function","e","language","CodeComponent","__html","highlight","highlightAuto","value","elementId","compile","content","markedOptions","assign","smartypants"],"mappings":";;;;;QAKgBA,M,GAAAA,M;;kBAuDD,UAAUC,OAAV,EAAmB;AAChC,SAAOD,OAAOC,OAAP,CAAP;AACD,C;;AA9DD;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEO,SAASD,MAAT,GAA+B;AAAA,MAAdC,OAAc,uEAAJ,EAAI;;AACpCA,UAAQC,UAAR,GAAqBD,QAAQC,UAAR,IAAsB,EAA3C;;AAEA,MAAMC,UAAU;AACdC,UAAM,IADQ;AAEdC,cAAU,IAFI;AAGdC,mBAAe,IAHD;AAIdC,SAAK;AAJS,GAAhB;AAMA,MAAMC,WAAW,8BAAeL,OAAf,EAAwBF,OAAxB,EAAiC;AAChDQ,QADgD,gBAC1CA,KAD0C,EACpC;AACV,UAAI;AACF,YAAMC,OAAO,gCAAUD,KAAV,EAAgB;AAC3BE,mBAAS,CAAC,OAAD;AADkB,SAAhB,EAEVD,IAFH;AAGA,YAAMR,aAAaU,OAAOC,IAAP,CAAYZ,QAAQC,UAApB,EAAgCY,GAAhC,CAAoC,UAAUC,GAAV,EAAe;AACpE,iBAAOd,QAAQC,UAAR,CAAmBa,GAAnB,CAAP;AACD,SAFkB,CAAnB;;AAIAZ,gBAAQC,IAAR,CAAaY,IAAb,CAAkB,gBAAMC,aAAN,CAAoB,YAAY;AAChD,iBAAO,mCAAIC,QAAJ,iBAAa,OAAb,sBAAyBN,OAAOC,IAAP,CAAYZ,QAAQC,UAApB,CAAzB,gBAAoEQ,IAApE,oEAAsFR,UAAtF,OAAqG,IAA5G;AACD,SAFiB,EAEf,EAACa,KAAKZ,QAAQG,aAAR,EAAN,EAFe,CAAlB;AAGD,OAXD,CAWE,OAAOa,CAAP,EAAU,CAAE;AACf,KAd+C;AAehDT,QAfgD,gBAe1CA,KAf0C,EAepCU,QAfoC,EAe1B;AACpB,UAAIA,aAAa,QAAjB,EAA2B;AACzB,eAAOZ,SAASC,IAAT,CAAcC,KAAd,CAAP;AACD,OAFD,MAEO;AAAA,YAGIW,aAHJ,GAGL,SAASA,aAAT,GAA0B;AACxB,iBAAO;AAAA;AAAA;AAAK,oDAAM,qBAAmBD,QAAzB,EAAqC,yBAAyB,EAACE,QAAQrB,QAAQsB,SAAR,GAAoBtB,QAAQsB,SAAR,CAAkBC,aAAlB,CAAgCd,KAAhC,EAAsCe,KAA1D,GAAkEf,KAA3E,EAA9D;AAAL,WAAP;AACD,SALI;;AACL,YAAMgB,YAAYvB,QAAQG,aAAR,EAAlB;;AAMAH,gBAAQE,QAAR,CAAiBqB,SAAjB,IAA8B,gBAAMT,aAAN,CAAoBI,aAApB,EAAmC,EAACN,KAAKW,SAAN,EAAnC,CAA9B;;AAEAvB,gBAAQC,IAAR,CAAaY,IAAb,CAAkBb,QAAQE,QAAR,CAAiBqB,SAAjB,CAAlB;;AAEA,sBAAYA,SAAZ;AACD;AACF;AA/B+C,GAAjC,CAAjB;;AAkCA,SAAO,SAASC,OAAT,CAAkBC,OAAlB,EAA+C;AAAA,QAApBC,aAAoB,uEAAJ,EAAI;;AACpD1B,YAAQC,IAAR,GAAe,EAAf;AACAD,YAAQE,QAAR,GAAmB,EAAnB;AACAF,YAAQI,GAAR,GAAc,EAAd;AACAJ,YAAQG,aAAR,GAAwB,CAAxB;AACA,0BAAOsB,OAAP,EAAgBhB,OAAOkB,MAAP,CAAc,EAACtB,UAAUA,QAAX,EAAqBuB,aAAa,IAAlC,EAAd,EAAuDF,aAAvD,CAAhB;;AAEA,WAAO,EAACzB,MAAMD,QAAQC,IAAf,EAAqBG,KAAKJ,QAAQI,GAAlC,EAAP;AACD,GARD;AASD;;AAKA","file":"components.js","sourcesContent":["import React from 'react';\nimport createRenderer from './createRenderer';\nimport marked from 'marked';\nimport {transform} from 'babel-standalone';\n\nexport function marksy (options = {}) {\n  options.components = options.components || {};\n\n  const tracker = {\n    tree: null,\n    elements: null,\n    nextElementId: null,\n    toc: null\n  };\n  const renderer = createRenderer(tracker, options, {\n    html (html) {\n      try {\n        const code = transform(html, {\n          presets: ['react']\n        }).code;\n        const components = Object.keys(options.components).map(function (key) {\n          return options.components[key];\n        });\n\n        tracker.tree.push(React.createElement(function () {\n          return new Function('React', ...Object.keys(options.components), `return ${code}`)(React, ...components) || null;\n        }, {key: tracker.nextElementId++}));\n      } catch (e) {}\n    },\n    code (code, language) {\n      if (language === 'marksy') {\n        return renderer.html(code)\n      } else {\n        const elementId = tracker.nextElementId++;\n\n        function CodeComponent () {\n          return <pre><code className={`hljs ${language}`} dangerouslySetInnerHTML={{__html: options.highlight ? options.highlight.highlightAuto(code).value : code}}></code></pre>\n        }\n\n        tracker.elements[elementId] = React.createElement(CodeComponent, {key: elementId});\n\n        tracker.tree.push(tracker.elements[elementId]);\n\n        return `{{${elementId}}}`;\n      }\n    }\n  })\n\n  return function compile (content, markedOptions = {}) {\n    tracker.tree = [];\n    tracker.elements = {};\n    tracker.toc = [];\n    tracker.nextElementId = 0;\n    marked(content, Object.assign({renderer: renderer, smartypants: true}, markedOptions));\n\n    return {tree: tracker.tree, toc: tracker.toc};\n  };\n}\n\n\nexport default function (options) {\n  return marksy(options)\n};\n"]}